{%- liquid
  assign p = section.settings.access_product
-%}

<style>
  /* Only this section heading span */
  #pricing-{{ section.id }} .section_heading span{
    border-radius: 16px;
    background: #01c5e3;
    padding: 4px 6px;
    display: inline-flex;
    color: #233052;
    font-size: 16px;
    font-style: normal;
    font-weight: 600;
    line-height: 1.1;
  }
  @media (min-width: 1200px){
    #pricing-{{ section.id }} .section_heading span{ font-size: 36px; }
  }

  /* section padding from settings */
  #pricing-{{ section.id }}{
    padding-top: {{ section.settings.mobile_padding_top }}px;
    padding-bottom: {{ section.settings.mobile_padding_bottom }}px;
  }
  @media (min-width: 1200px){
    #pricing-{{ section.id }}{
      padding-top: {{ section.settings.desktop_padding_top }}px;
      padding-bottom: {{ section.settings.desktop_padding_bottom }}px;
    }
    .tradeedge-wrap svg{
      width: 100%;
      height: auto;
    }
  }
</style>

<section
  id="pricing-{{ section.id }}"
  data-section-id="{{ section.id }}"
  class="xcl-bg-[#1e1e1e] xcl-text-white lg:xcl-px-4 xl:xcl-px-0 xcl-py-10 xl:xcl-py-16"
  style="background-color: {{ section.settings.section_bg }}; color: {{ section.settings.section_text_color }};"
>
  <div class="xcl-max-w-[1110px] xcl-mx-auto xcl-px-4 lg:xcl-px-0 xcl-relative xcl-z-10">

    {%- comment -%} SECTION HEADING {%- endcomment -%}
    <div class="xcl-text-center xcl-mb-8 xl:xcl-mb-[76px]">
      {% if section.settings.section_title != blank %}
        <h3
          class="section_heading xcl-text-center xcl-pb-2 xcl-text-[24px] xcl-text-[#01C5E3] xcl-font-semibold xl:xcl-text-[48px]"
          style="color: {{ section.settings.section_title_color }};"
        >
          {{ section.settings.section_title }}
        </h3>
      {% endif %}
    </div>

    {%- comment -%} PRICING CARDS (BLOCKS) {%- endcomment -%}
    <div  
      class="
        xcl-grid xcl-grid-cols-1 md:xcl-grid-cols-2 lg:xcl-grid-cols-3
        xcl-gap-11 xl:xcl-gap-10 xcl-mb-[18px] xl:xcl-mb-10
      "
    >
      {% if p == blank %}
        <div class="xcl-col-span-full xcl-text-center xcl-opacity-80">
          Please select <strong>Access Product (Single product)</strong> in section settings.
        </div>
      {% else %}
        {% for block in section.blocks %}
          {% if block.type == 'pricing_card' %}
            {%- liquid
              assign vid = block.settings.variant_id | plus: 0
              assign v = p.variants | where: 'id', vid | first
              assign current_price = v.price
              assign compare_price = v.compare_at_price
            -%}

            <div
              {{ block.shopify_attributes }}
              class="
                xcl-relative xcl-rounded-[16px] xcl-border-solid xcl-border-2
                xcl-bg-[#1e1e1e] xcl-px-2 xcl-pt-[25px] xcl-pb-2
                xcl-flex xcl-flex-col xcl-gap-4
                xcl-shadow-[0_18px_40px_rgba(0,0,0,0.75)]
              "
              style="border-color: {{ block.settings.border_color | default: block.settings.accent | default: '#383838' }};"
            >
              {% if block.settings.label != blank %}
                <div class="xcl-absolute xcl--top-[13px] xcl-left-1/2 xcl--translate-x-1/2">
                  <div
                    class="xcl-inline-flex xcl-items-center xcl-justify-center xcl-rounded-full xcl-px-4 xcl-py-1 xcl-text-[12px] xcl-font-bold xcl-text-[#031015]"
                    style="background: {{ block.settings.accent }};"
                  >
                    {{ block.settings.label }}
                  </div>
                </div>
              {% endif %}

              <div class="xcl-px-4 xcl-pb-2 xl:xcl-pb-6">
                <div class="xcl-flex xcl-gap-[10px] xcl-items-center xcl-mb-[10px]">
                  {% if block.settings.icon != blank %}
                    <div class="xcl-w-10 xcl-h-10 xcl-mb-3">
                      <img
                        src="{{ block.settings.icon | img_url: '120x' }}"
                        alt="Plan icon"
                        class="xcl-w-10 xcl-h-10 xcl-object-contain"
                      >
                    </div>
                  {% endif %}

                  <h3 class="xcl-text-[24px] xl:xcl-text-[24px] xcl-font-semibold xcl-text-white">
                    {{ block.settings.title }}
                  </h3>
                </div>

                <div>
                  <div class="xcl-flex xcl-items-center xcl-gap-3 xcl-flex-wrap">
                    {%- if compare_price and compare_price > current_price -%}
                      {%- assign diff = compare_price | minus: current_price -%}
                      {%- assign off = diff | times: 100.0 | divided_by: compare_price | round -%}

                      <span class="xcl-text-[18px] xcl-font-heading xl:xcl-text-[26px] xcl-text-[#F2FAFD] xcl-font-semibold xcl-line-through">
                        {{ compare_price | money }}
                      </span>

                      <span class="xcl-inline-flex xcl-items-center xcl-font-heading xcl-justify-center xcl-rounded-[10px] xcl-px-2 xcl-py-1 xcl-text-[18px] xcl-font-bold xcl-text-[#031015] xcl-bg-[#8CC63F]">
                        {{ off }}% OFF
                      </span>
                    {%- endif -%}
                  </div>

                  <div class="xcl-flex xcl-items-baseline xcl-gap-1 xcl-mt-2">
                    <span class="xcl-text-[32px] xl:xcl-text-[44px] xcl-font-bold xcl-font-heading xcl-text-white">
                      {{ current_price | money }}
                    </span>

                    {% if block.settings.suffix != blank %}
                      <span class="xcl-text-[16px] xcl-text-[#ffffff]">
                        {{ block.settings.suffix }}
                      </span>
                    {% endif %}
                  </div>

                  {% if block.settings.trial != blank %}
                    <p
                      class="xcl-text-[14px] xcl-font-bold xcl-mt-2 xcl-min-h-[40px]"
                      style="color: {{ block.settings.accent }};"
                    >
                      {{ block.settings.trial }}
                    </p>
                  {% endif %}
                </div>
              </div>

              <div class="xcl-relative">
                {% if block.settings.refund != blank %}
                  <div class="xcl-absolute xcl--top-[13px] xcl-left-1/2 xcl--translate-x-1/2 xcl-z-[2] xcl-w-[90%]">
                    <div
                      class="xcl-flex xcl-items-center xcl-justify-center xcl-rounded-full xcl-px-5 xcl-py-1 xcl-text-[14px] xcl-font-semibold xcl-text-[#031015] xl:xcl-px-3"
                      style="background: {{ block.settings.accent }};"
                    >
                      {{ block.settings.refund }}
                    </div>
                  </div>
                {% endif %}

                <div
                  class="xcl-rounded-[18px] xcl-border xcl-border-solid xcl-pt-7 xcl-px-4 xcl-pb-4 xcl-space-y-2 xcl-text-[13px]"
                  style="
                    border-color: {{ block.settings.accent }};
                    background: {{ block.settings.inner_bg }};
                    {% if block.settings.inner_bg_img != blank %}
                      background-image: url('{{ block.settings.inner_bg_img | img_url: '600x' }}');
                      background-size: cover;
                      background-repeat: no-repeat;
                    {% endif %}
                  "
                >
                  {% for i in (1..6) %}
                    {% assign key = 'feature' | append: i %}
                    {% if block.settings[key] != blank %}
                      <div class="xcl-flex xcl-items-center xcl-gap-2">
                        <span class="xcl-mt-[3px]"></span>
                        <span class="xcl-text-[14px]">{{ block.settings[key] }}</span>
                      </div>
                    {% endif %}
                  {% endfor %}

                  {% if v and v.available %}
                    <form method="post" action="/cart/add" class="xcl-pt-6 js-checkout-form">
                      <input type="hidden" name="id" value="{{ v.id }}">
                      <input type="hidden" name="quantity" value="1">
                      <input type="hidden" name="return_to" value="/checkout">

                      <button
                        type="submit"
                        class="js-checkout-btn xcl-h-[40px] xcl-inline-flex xcl-w-full xcl-items-center xcl-justify-center xcl-cursor-pointer xcl-border-none xcl-rounded-[16px] xcl-text-[#031015] xcl-text-[16px] xcl-font-bold xcl-py-3 xcl-px-3 xcl-gap-2 hover:xcl-brightness-110 xcl-transition xcl-duration-150"
                        style="background: {{ block.settings.btn_bg }};"
                      >
                        <span class="js-btn-text">
                          {{ block.settings.btn_label }}
                          <span>➜</span>
                        </span>
                        <span class="js-btn-loader xcl-hidden"></span>
                      </button>
                    </form>
                  {% else %}
                    <button
                      type="button"
                      class="xcl-inline-flex xcl-w-full xcl-items-center xcl-justify-center xcl-cursor-pointer xcl-border-none xcl-rounded-[16px] xcl-text-[#031015] xcl-text-[16px] xcl-font-bold xcl-py-3 xcl-px-3 xcl-gap-2 hover:xcl-brightness-110 xcl-transition xcl-duration-150"
                      style="background: {{ block.settings.btn_bg }};"
                      disabled
                    >
                      Sold Out
                    </button>
                  {% endif %}
                </div>
              </div>

            </div>
          {% endif %}
        {% endfor %}
      {% endif %}
    </div>

    {%- comment -%} SAFE & SECURE CHECKOUT BOX {%- endcomment -%}
    <div
      class="
        xcl-rounded-2xl xcl-border-[#D9D9D9] xcl-border-solid xcl-border-2
        xcl-bg-[#1e1e1e] xcl-px-[14px] xcl-py-[10px]
        xl:xcl-px-6 xl:xcl-py-6
        xcl-flex xcl-flex-col xcl-gap-4 xl:xcl-gap-6
        xcl-items-start xl:xcl-items-center
      "
    >
      <div class="xcl-w-full">
        <p class="xcl-text-[16px] xcl-leading-normal xcl-font-heading xcl-font-semibold xcl-mb-3 xl:xcl-text-[28px]">
          {{ section.settings.secure_title }}
        </p>
        {% if section.settings.secure_subtitle != blank %}
          <p class="xcl-text-xs xcl-items-center xcl-text-[#fff] xcl-flex xcl-gap-2 xl:xcl-text-[18px]">
            <span>{{ section.settings.secure_subtitle }}</span>
            <span class="xcl-flex xcl-items-center xcl-gap-1">
              <span>Razorpay</span>
            </span>
          </p>
        {% endif %}
      </div>

      <div class="xcl-flex xcl-items-center xcl-gap-2 xcl-w-full xcl-justify-between xl:xcl-items-end xl:xcl-text-right">
        <div class="xcl-flex xcl-items-center xcl-gap-2">
          <div class="xcl-flex xcl-items-center xcl-justify-center xl:xcl-hidden"></div>
          <div class="xcl-items-center xcl-justify-center xcl-hidden xl:xcl-flex"></div>
        </div>

        <div class="xcl-flex xcl-flex-wrap xcl-gap-3 xcl-items-center xl:xcl-hidden">
          {% if section.settings.show_upi %}{% endif %}
          {% if section.settings.show_visa %}<span class="xcl-text-xs xl:xcl-text-sm xcl-font-semibold"></span>{% endif %}
          {% if section.settings.show_mastercard %}<span class="xcl-text-xs xl:xcl-text-sm xcl-font-semibold"></span>{% endif %}
        </div>

        <div class="xcl-flex-wrap xcl-gap-3 xl:xcl-gap-10 xcl-items-center xcl-hidden xl:xcl-flex">
          {% if section.settings.show_upi %}{% endif %}
          {% if section.settings.show_visa %}<span class="xcl-text-xs xl:xcl-text-sm xcl-font-semibold"></span>{% endif %}
          {% if section.settings.show_mastercard %}<span class="xcl-text-xs xl:xcl-text-sm xcl-font-semibold"></span>{% endif %}
        </div>
      </div>
    </div>

  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const root = document.querySelector("#pricing-{{ section.id }}");
  if (!root) return;

  // ONLY forms inside this section (so other add-to-cart forms won't break)
  root.querySelectorAll("form[action='/cart/add']").forEach(function (form) {
    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      // mark to clear on return from checkout
      sessionStorage.setItem("xcl_clear_cart_on_return", "1");

      const btn = form.querySelector("button[type='submit']");
      const text = btn?.querySelector(".js-btn-text");
      const loader = btn?.querySelector(".js-btn-loader");

      if (btn) { btn.disabled = true; btn.style.pointerEvents = "none"; }
      if (text) text.classList.add("xcl-hidden");
      if (loader) loader.classList.remove("xcl-hidden");

      try {
        await fetch("/cart/clear.js", { method: "POST" });

        const fd = new FormData(form);
        await fetch("/cart/add.js", { method: "POST", body: fd });

        window.location.href = "/checkout";
      } catch (err) {
        if (btn) { btn.disabled = false; btn.style.pointerEvents = "auto"; }
        if (text) text.classList.remove("xcl-hidden");
        if (loader) loader.classList.add("xcl-hidden");
        console.error(err);
      }
    });
  });
});
</script>

{% schema %}
{
  "name": "Pricing – Cards (Blocks)",
  "settings": [
    {
      "type": "color",
      "label": "section background color",
      "id": "section_bg",
      "default": "#1E1E1E"
    },
    {
      "type": "color",
      "label": "section text color",
      "id": "section_text_color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "mobile_padding_top",
      "label": "Mobile padding top (px)",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "mobile_padding_bottom",
      "label": "Mobile padding bottom (px)",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "desktop_padding_top",
      "label": "Desktop padding top (px)",
      "min": 0,
      "max": 180,
      "step": 4,
      "unit": "px",
      "default": 64
    },
    {
      "type": "range",
      "id": "desktop_padding_bottom",
      "label": "Desktop padding bottom (px)",
      "min": 0,
      "max": 180,
      "step": 4,
      "unit": "px",
      "default": 64
    },
    {
      "type": "html",
      "label": "Section title",
      "id": "section_title",
      "default": "TradeEdge <span> Pro</span> Features"
    },
    {
      "type": "color",
      "label": "section title color",
      "id": "section_title_color",
      "default": "#01C5E3"
    },

    { "type": "header", "content": "Secure checkout strip" },
    { "type": "text", "id": "secure_title", "label": "Title", "default": "Safe and Secure Checkout" },
    { "type": "text", "id": "secure_subtitle", "label": "Subtitle", "default": "Payments are processed by" },
    { "type": "checkbox", "id": "show_upi", "label": "Show UPI", "default": true },
    { "type": "checkbox", "id": "show_visa", "label": "Show VISA", "default": true },
    { "type": "checkbox", "id": "show_mastercard", "label": "Show Mastercard", "default": true },

    { "type": "product", "id": "access_product", "label": "Access Product (Single product)" }
  ],
  "blocks": [
    {
      "type": "pricing_card",
      "name": "Pricing Card",
      "settings": [
        { "type": "number", "id": "variant_id", "label": "Variant ID (of Access Product)" },

        { "type": "text", "id": "label", "label": "Top label", "default": "MOST POPULAR" },
        { "type": "image_picker", "id": "icon", "label": "Icon" },

        { "type": "text", "id": "title", "label": "Title", "default": "Quarterly Access" },
        { "type": "text", "id": "suffix", "label": "Price suffix", "default": "/ 90 days" },
        { "type": "text", "id": "trial", "label": "Trial / sub text", "default": "Perfect for traders who want flexibility" },
        { "type": "text", "id": "refund", "label": "Refund pill text", "default": "7-Day Money-Back Guarantee" },

        { "type": "text", "id": "feature1", "label": "Feature 1", "default": "Everything in Weekly plan" },
        { "type": "text", "id": "feature2", "label": "Feature 2", "default": "Future updates included" },
        { "type": "text", "id": "feature3", "label": "Feature 3", "default": "Priority WhatsApp Support" },
        { "type": "text", "id": "feature4", "label": "Feature 4" },
        { "type": "text", "id": "feature5", "label": "Feature 5" },
        { "type": "text", "id": "feature6", "label": "Feature 6" },

        { "type": "text", "id": "btn_label", "label": "Button label", "default": "GET ACCESS" },
        { "type": "color", "id": "btn_bg", "label": "Button background", "default": "#00E5FF" },

        { "type": "color", "id": "accent", "label": "Accent color", "default": "#00C4FF" },
        { "type": "color", "id": "inner_bg", "label": "Inner box background", "default": "#0b1f2a" },
        { "type": "color", "id": "border_color", "label": "Outer border color", "default": "#00C4FF" },
        { "type": "image_picker", "id": "inner_bg_img", "label": "Inner Bg image (optional)" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Pricing – Cards (Blocks)",
      "blocks": [
        { "type": "pricing_card" },
        { "type": "pricing_card" },
        { "type": "pricing_card" }
      ]
    }
  ]
}
{% endschema %}
 